# Dispersão: valor_cupom x repasse_picmoney com linha de tendência fixa (y = -0.36 + 0.1286*x)

import pandas as pd
import numpy as np
import matplotlib.pyplot as plt

# Lê o arquivo CSV (Base Transações) (ajuste o caminho se necessário)
file_trans = "/content/PicMoney-Base_de_Transa__es_-_Cupons_Capturados-100000 linhas (1).csv"
df_trans = pd.read_csv(file_trans, sep=";", decimal=",")

# Converte colunas para numéricas
df_trans["valor_cupom"] = pd.to_numeric(df_trans["valor_cupom"], errors="coerce")
df_trans["repasse_picmoney"] = pd.to_numeric(df_trans["repasse_picmoney"], errors="coerce")

# Mantém apenas colunas de interesse sem valores nulos
df_disp = df_trans[["valor_cupom", "repasse_picmoney"]].dropna()

# Coeficientes da regressão linear (fixos)
a = -0.36
b = 0.1286

# Cria pontos da reta de tendência
x_line = np.linspace(df_disp["valor_cupom"].min(), df_disp["valor_cupom"].max(), 200)
y_line = a + b * x_line

# Plota dispersão + linha de tendência
plt.figure(figsize=(7,5))
plt.scatter(df_disp["valor_cupom"], df_disp["repasse_picmoney"], color="black", alpha=0.5, s=10)
plt.plot(x_line, y_line, color="red", linewidth=2)
plt.title("Gráfico de Dispersão")
plt.xlabel("Valor do cupom (R$)")
plt.ylabel("Repasse (R$)")
plt.grid(True, linestyle="--", alpha=0.3)
plt.show()

# Exibe a equação da reta ao final do gráfico
print("Equação da reta de regressão usada no gráfico:")
print(f"y = {a} + {b} * x")
